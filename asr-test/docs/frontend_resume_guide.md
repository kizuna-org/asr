# フロントエンド学習再開機能ガイド

このドキュメントでは、フロントエンド（Streamlit）での学習再開機能の使用方法について説明します。

## 概要

フロントエンドでは以下の学習再開機能が利用できます：

1. **学習制御パネル**: サイドバーでの学習開始・再開・停止
2. **チェックポイント管理ページ**: チェックポイントの一覧表示と管理
3. **グラフ表示の継続**: 学習再開時のグラフデータの継続表示
4. **学習再開情報の表示**: どのチェックポイントから再開したかの表示

## 機能詳細

### 1. 学習制御パネル（サイドバー）

サイドバーの「🎯 学習制御」セクションで以下の操作が可能です：

#### 学習再開オプション
- **チェックポイントから再開**: チェックボックスで有効/無効を切り替え
- **再開するチェックポイントを選択**: ドロップダウンで特定のチェックポイントを選択

#### 学習制御ボタン
- **🆕 新規学習開始**: 最初から学習を開始（チェックポイントを無視）
- **🔄 学習再開**: チェックポイントから学習を再開
- **🛑 学習停止**: 現在の学習を停止

### 2. チェックポイント管理ページ

「📂 チェックポイント管理」ページでは以下の機能が利用できます：

#### フィルタリング
- **モデル名でフィルタ**: 特定のモデルのチェックポイントのみ表示
- **データセット名でフィルタ**: 特定のデータセットのチェックポイントのみ表示

#### チェックポイント一覧
- チェックポイント名、モデル、データセット、エポック数、サイズ、作成日時を表示
- テーブル形式で一覧表示

#### 学習再開機能
- チェックポイントを選択して詳細情報を表示
- 学習再開パラメータを設定（エポック数、バッチサイズ、軽量モード等）
- 選択したチェックポイントから学習を再開

### 3. グラフ表示の継続

学習再開時、以下のグラフが継続して表示されます：

#### 学習ロスグラフ
- 学習ロスと検証ロスの推移を表示
- 学習再開前のデータも含めて継続表示

#### 学習率グラフ
- 学習率の推移を表示
- スケジューラーの状態も正しく復元

### 4. 学習再開情報の表示

学習中に以下の情報が表示されます：

#### メトリクス表示
- **Epoch**: 現在のエポック数/総エポック数
- **Step**: 現在のステップ数/総ステップ数
- **再開元**: どのチェックポイントから再開したかの情報

## 使用手順

### 基本的な学習再開

1. **サイドバーで学習設定**
   - モデルとデータセットを選択
   - エポック数とバッチサイズを設定
   - 「チェックポイントから再開」をチェック

2. **学習再開の実行**
   - 「🔄 学習再開」ボタンをクリック
   - 最新のチェックポイントから自動的に再開

3. **進捗の確認**
   - メインダッシュボードでグラフとログを確認
   - 学習再開情報がメトリクスに表示される

### 特定のチェックポイントから再開

1. **チェックポイント管理ページに移動**
   - サイドバーの「📂 チェックポイント管理」をクリック

2. **チェックポイントの選択**
   - フィルタリングで対象を絞り込み
   - 再開したいチェックポイントを選択

3. **学習再開パラメータの設定**
   - 追加エポック数、バッチサイズ等を設定
   - 軽量モードやサンプル数制限を設定

4. **学習再開の実行**
   - 「🔄 このチェックポイントから学習を再開」ボタンをクリック
   - 自動的にメインダッシュボードに戻る

## 画面構成

### メインダッシュボード
```
┌─────────────────────────────────────────────────────────┐
│ ASR 学習ダッシュボード                                  │
├─────────────────────────────────────────────────────────┤
│ [🏠 メイン] [🤖 モデル] [📂 チェックポイント]           │
├─────────────────────────────────────────────────────────┤
│ 推論テストセクション                                     │
├─────────────────────────────────────────────────────────┤
│ Epoch: 5/10  Step: 150/200  再開元: Epoch 3            │
├─────────────────────────────────────────────────────────┤
│ 学習ロスグラフ        │ 学習率グラフ                    │
│ [グラフ表示]          │ [グラフ表示]                    │
├─────────────────────────────────────────────────────────┤
│ ログ表示                                               │
└─────────────────────────────────────────────────────────┘
```

### チェックポイント管理ページ
```
┌─────────────────────────────────────────────────────────┐
│ 📂 チェックポイント管理                                 │
├─────────────────────────────────────────────────────────┤
│ 🔍 フィルタリング                                       │
│ モデル名: [conformer ▼]  データセット: [ljspeech ▼]    │
├─────────────────────────────────────────────────────────┤
│ 📋 チェックポイント一覧                                 │
│ [テーブル表示]                                          │
├─────────────────────────────────────────────────────────┤
│ 🔄 学習再開                                             │
│ チェックポイント選択: [conformer-ljspeech-epoch-5.pt ▼] │
│ 詳細情報表示                                            │
│ パラメータ設定                                          │
│ [🔄 このチェックポイントから学習を再開]                  │
└─────────────────────────────────────────────────────────┘
```

## トラブルシューティング

### よくある問題

1. **チェックポイントが表示されない**
   - 学習を実行してチェックポイントを作成してください
   - フィルタリング条件を確認してください

2. **学習再開が失敗する**
   - バックエンドサービスが起動しているか確認してください
   - ログを確認してエラーの詳細を確認してください

3. **グラフが表示されない**
   - 学習が開始されているか確認してください
   - ブラウザをリフレッシュしてみてください

4. **学習再開情報が表示されない**
   - 学習が実際に再開されているか確認してください
   - セッション状態をリセットしてみてください

### デバッグ方法

1. **ログの確認**
   - メインダッシュボードのログセクションでエラーメッセージを確認

2. **API の直接テスト**
   - テストスクリプト `test_resume_training.py` を実行

3. **ブラウザの開発者ツール**
   - ネットワークタブでAPIリクエストの状況を確認

## ベストプラクティス

1. **定期的なチェックポイント確認**
   - チェックポイント管理ページで定期的にチェックポイントの状況を確認

2. **適切なフィルタリング**
   - 大量のチェックポイントがある場合は、フィルタリングを活用

3. **学習パラメータの調整**
   - 学習再開時は、必要に応じてエポック数やバッチサイズを調整

4. **進捗の監視**
   - 学習再開後は、グラフとログで進捗を適切に監視

## 技術的な詳細

### セッション状態管理
- `st.session_state.resume_info`: 学習再開情報を保存
- `st.session_state.progress_df`: 学習ロスデータを保存
- `st.session_state.lr_df`: 学習率データを保存

### API エンドポイント
- `GET /api/checkpoints`: チェックポイント一覧取得
- `POST /api/train/resume`: 学習再開
- `POST /api/train/start`: 学習開始（再開オプション付き）

### データフロー
1. フロントエンド → バックエンドAPI → チェックポイント読み込み
2. バックエンド → WebSocket → フロントエンド（進捗更新）
3. フロントエンド → グラフ表示（継続データ）

