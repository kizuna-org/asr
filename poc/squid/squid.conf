cache_peer http-p.srv.cc.suzuka-ct.ac.jp parent 8080 0 no-query default
never_direct allow all

debug_options ALL,

# ======== ACL (Access Control List) の設定 ========
# Dockerのカスタムネットワークからのアクセスを許可
acl docker_network src 172.20.0.0/24

# ローカルネットワークからのアクセスを許可 (例: 192.168.1.0/24)
acl localnet src 192.168.0.0/16

# 標準的なポートを定義
acl SSL_ports port 443
acl Safe_ports port 80          # http
acl Safe_ports port 443         # https

# CONNECTメソッド用のACL
acl CONNECT method CONNECT

# ======== アクセス許可・拒否ルール ========
# Safe_ports 以外へのアクセスを拒否
http_access deny !Safe_ports

# SSL_ports 以外へのCONNECTメソッドを拒否 (HTTPS通信に必須)
# http_access deny CONNECT !SSL_ports

# Docker内部ネットワークとローカルネットワークからのアクセスを許可
http_access allow docker_network
http_access allow localnet

# 上記のルールにマッチしないものは全て拒否
http_access deny all

# ======== ポートの設定 ========
# ★★★ ここを修正 ★★★
# シンプルなフォワードプロキシとして3128番ポートで待ち受ける
http_port 3128

# ======== キャッシュとログの設定 ========
cache_dir ufs /var/spool/squid 100 16 256
coredump_dir /var/spool/squid
access_log daemon:/var/log/squid/access.log squid

# ======== その他 ========
refresh_pattern . 0 20% 4320
